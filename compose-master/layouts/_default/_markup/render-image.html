{{ if .Page.Site.Params.useWebp }}
  
  

{{ else }}

  {{ $src := .Destination }}
  {{ $alt := .Text | safeHTMLAttr }}
  {{ $caption := .Title | default "" | safeHTML }}

  {{ $img := .Page.Resources.GetMatch (path.Base $src) }}
  {{ $imgType := "" }}
  {{ with $img }}{{ $imgType = .MediaType.Type }}{{ end }}

  {{ if and $img (in (slice "image/png" "image/jpeg") $imgType) }}

    {{ $small := $img.Resize "320x" }}  <!-- мобильная версия -->
    {{ $medium := $img.Resize "480x" }} <!-- планшеты и маленькие десктопы -->
    {{ $large := $img }}                 <!-- оригинал -->

    <figure>
      <img
        src="{{ $medium.RelPermalink }}"
        srcset="
          {{ $small.RelPermalink }} {{ $small.Width }}w,
          {{ $medium.RelPermalink }} {{ $medium.Width }}w,
          {{ $large.RelPermalink }} {{ $large.Width }}w
        "
        sizes="(max-width: 600px) 320px, (max-width: 900px) 480px, 100vw"
        width="{{ $img.Width }}"
        height="{{ $img.Height }}"
        alt="{{ if $alt }}{{ $alt }}{{ else if $caption }}{{ $caption | markdownify | plainify }}{{ else }}&nbsp;{{ end }}"
        loading="lazy"
        decoding="async" />
      {{ if $caption }}
        <figcaption>{{ $caption | markdownify }}</figcaption>
      {{ end }}
    </figure>

  {{ else }}
    <img src="{{ $src }}" alt="{{ $alt }}" loading="lazy" decoding="async" />
  {{ end }}

{{ end }}